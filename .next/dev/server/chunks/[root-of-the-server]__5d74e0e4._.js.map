{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["file:///Users/daveonthetrack/Projects/Finote%20Loza/finote-loza-school/pages/api/admin/students/list.js"],"sourcesContent":["import { createClient } from '@supabase/supabase-js';\n\nexport default async function handler(req, res) {\n  if (req.method !== 'GET') {\n    return res.status(405).json({ error: 'Method not allowed' });\n  }\n\n  try {\n    const url = process.env.NEXT_PUBLIC_SUPABASE_URL;\n    const key = process.env.SUPABASE_SERVICE_ROLE_KEY;\n    if (!url || !key) return res.status(500).json({ error: 'Server misconfigured' });\n    const supabase = createClient(url, key);\n\n    const { q = '', grade = '' } = req.query || {};\n\n    let query = supabase\n      .from('students')\n      .select('*')\n      .order('created_at', { ascending: false });\n\n    if (grade) {\n      query = query.eq('grade_level', grade);\n    }\n\n    const { data, error } = await query;\n    if (error) return res.status(400).json({ error: error.message });\n\n    const normalizedQ = String(q).trim().toLowerCase();\n    const filtered = !normalizedQ\n      ? data || []\n      : (data || []).filter((s) => {\n          const fullName = [s.first_name, s.middle_name, s.last_name].filter(Boolean).join(' ').toLowerCase();\n          const sid = (s.student_id || '').toLowerCase();\n          return fullName.includes(normalizedQ) || sid.includes(normalizedQ);\n        });\n\n    return res.status(200).json({ students: filtered });\n  } catch (e) {\n    return res.status(500).json({ error: 'Internal server error' });\n  }\n}\n\n\n\n\n\n"],"names":[],"mappings":";;;;AAAA;;AAEe,eAAe,QAAQ,GAAG,EAAE,GAAG;IAC5C,IAAI,IAAI,MAAM,KAAK,OAAO;QACxB,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO;QAAqB;IAC5D;IAEA,IAAI;QACF,MAAM;QACN,MAAM,MAAM,QAAQ,GAAG,CAAC,yBAAyB;QACjD,IAAI,CAAC,OAAO,CAAC,KAAK,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO;QAAuB;QAC9E,MAAM,WAAW,IAAA,gRAAY,EAAC,KAAK;QAEnC,MAAM,EAAE,IAAI,EAAE,EAAE,QAAQ,EAAE,EAAE,GAAG,IAAI,KAAK,IAAI,CAAC;QAE7C,IAAI,QAAQ,SACT,IAAI,CAAC,YACL,MAAM,CAAC,KACP,KAAK,CAAC,cAAc;YAAE,WAAW;QAAM;QAE1C,IAAI,OAAO;YACT,QAAQ,MAAM,EAAE,CAAC,eAAe;QAClC;QAEA,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM;QAC9B,IAAI,OAAO,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO,MAAM,OAAO;QAAC;QAE9D,MAAM,cAAc,OAAO,GAAG,IAAI,GAAG,WAAW;QAChD,MAAM,WAAW,CAAC,cACd,QAAQ,EAAE,GACV,CAAC,QAAQ,EAAE,EAAE,MAAM,CAAC,CAAC;YACnB,MAAM,WAAW;gBAAC,EAAE,UAAU;gBAAE,EAAE,WAAW;gBAAE,EAAE,SAAS;aAAC,CAAC,MAAM,CAAC,SAAS,IAAI,CAAC,KAAK,WAAW;YACjG,MAAM,MAAM,CAAC,EAAE,UAAU,IAAI,EAAE,EAAE,WAAW;YAC5C,OAAO,SAAS,QAAQ,CAAC,gBAAgB,IAAI,QAAQ,CAAC;QACxD;QAEJ,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,UAAU;QAAS;IACnD,EAAE,OAAO,GAAG;QACV,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO;QAAwB;IAC/D;AACF"}}]
}