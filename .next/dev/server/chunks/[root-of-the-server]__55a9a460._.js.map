{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["file:///Users/daveonthetrack/Projects/Finote%20Loza/finote-loza-school/pages/api/admin/parents/list.js"],"sourcesContent":["import { createClient } from '@supabase/supabase-js';\n\nexport default async function handler(req, res) {\n  if (req.method !== 'GET') {\n    return res.status(405).json({ error: 'Method not allowed' });\n  }\n\n  try {\n    const url = process.env.NEXT_PUBLIC_SUPABASE_URL;\n    const key = process.env.SUPABASE_SERVICE_ROLE_KEY;\n    if (!url || !key) {\n      return res.status(500).json({ error: 'Server misconfigured' });\n    }\n    const supabase = createClient(url, key);\n\n    // Fetch parents\n    const { data: parents, error: pErr } = await supabase\n      .from('parents')\n      .select('*')\n      .order('created_at', { ascending: false });\n    if (pErr) return res.status(400).json({ error: pErr.message });\n\n    // Fetch relationships in one query\n    const { data: rels, error: rErr } = await supabase\n      .from('parent_students')\n      .select('parent_id, students:students ( id, first_name, last_name, student_id )');\n    if (rErr) return res.status(400).json({ error: rErr.message });\n\n    const parentIdToStudents = {};\n    (rels || []).forEach((row) => {\n      if (!parentIdToStudents[row.parent_id]) parentIdToStudents[row.parent_id] = [];\n      if (row.students) parentIdToStudents[row.parent_id].push(row.students);\n    });\n\n    const enriched = (parents || []).map((p) => ({\n      ...p,\n      linked_students: parentIdToStudents[p.id] || []\n    }));\n\n    return res.status(200).json({ parents: enriched });\n  } catch (e) {\n    return res.status(500).json({ error: 'Internal server error' });\n  }\n}\n\n\n"],"names":[],"mappings":";;;;AAAA;;AAEe,eAAe,QAAQ,GAAG,EAAE,GAAG;IAC5C,IAAI,IAAI,MAAM,KAAK,OAAO;QACxB,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO;QAAqB;IAC5D;IAEA,IAAI;QACF,MAAM;QACN,MAAM,MAAM,QAAQ,GAAG,CAAC,yBAAyB;QACjD,IAAI,CAAC,OAAO,CAAC,KAAK;YAChB,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;gBAAE,OAAO;YAAuB;QAC9D;QACA,MAAM,WAAW,IAAA,gRAAY,EAAC,KAAK;QAEnC,gBAAgB;QAChB,MAAM,EAAE,MAAM,OAAO,EAAE,OAAO,IAAI,EAAE,GAAG,MAAM,SAC1C,IAAI,CAAC,WACL,MAAM,CAAC,KACP,KAAK,CAAC,cAAc;YAAE,WAAW;QAAM;QAC1C,IAAI,MAAM,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO,KAAK,OAAO;QAAC;QAE5D,mCAAmC;QACnC,MAAM,EAAE,MAAM,IAAI,EAAE,OAAO,IAAI,EAAE,GAAG,MAAM,SACvC,IAAI,CAAC,mBACL,MAAM,CAAC;QACV,IAAI,MAAM,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO,KAAK,OAAO;QAAC;QAE5D,MAAM,qBAAqB,CAAC;QAC5B,CAAC,QAAQ,EAAE,EAAE,OAAO,CAAC,CAAC;YACpB,IAAI,CAAC,kBAAkB,CAAC,IAAI,SAAS,CAAC,EAAE,kBAAkB,CAAC,IAAI,SAAS,CAAC,GAAG,EAAE;YAC9E,IAAI,IAAI,QAAQ,EAAE,kBAAkB,CAAC,IAAI,SAAS,CAAC,CAAC,IAAI,CAAC,IAAI,QAAQ;QACvE;QAEA,MAAM,WAAW,CAAC,WAAW,EAAE,EAAE,GAAG,CAAC,CAAC,IAAM,CAAC;gBAC3C,GAAG,CAAC;gBACJ,iBAAiB,kBAAkB,CAAC,EAAE,EAAE,CAAC,IAAI,EAAE;YACjD,CAAC;QAED,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,SAAS;QAAS;IAClD,EAAE,OAAO,GAAG;QACV,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO;QAAwB;IAC/D;AACF"}}]
}